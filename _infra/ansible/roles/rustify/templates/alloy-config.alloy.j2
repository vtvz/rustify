// Scrape metrics from pushgateway
prometheus.scrape "pushgateway" {
  targets = [{
    __address__ = "pushgateway:9091",
  }]
  forward_to      = [prometheus.remote_write.grafana_cloud.receiver]
  scrape_interval = "60s"
  metrics_path    = "/metrics"
  honor_labels    = true
}

// Remote write to Grafana Cloud
prometheus.remote_write "grafana_cloud" {
  endpoint {
    url = "{{ rustify_alloy_grafana_cloud_url }}"

    basic_auth {
      username = "{{ rustify_alloy_grafana_cloud_username }}"
      password = "{{ rustify_alloy_grafana_cloud_api_key }}"
    }

    queue_config {
      max_shards           = 1
      max_samples_per_send = 500
      batch_send_deadline  = "60s"
    }
  }
}
